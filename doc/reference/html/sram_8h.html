<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>BlueLab: sram.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BlueLab
   &#160;<span id="projectnumber">BlueLab-7.1-Release</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_885cc87fac2d91e269af0a5a959fa5f6.html">E:</a></li><li class="navelem"><a class="el" href="dir_c7e0e8d12b42f3739b71747656f18cd0.html">work_layne</a></li><li class="navelem"><a class="el" href="dir_21e8aa1b508721822d5da9358e8a66b3.html">layne</a></li><li class="navelem"><a class="el" href="dir_e4efa088505d514b69950f8abe76ce9a.html">csr8670</a></li><li class="navelem"><a class="el" href="dir_d69a05324820a15d5f908ec5057bc420.html">tools</a></li><li class="navelem"><a class="el" href="dir_33b4f9d0a7e332b5324a4fedfd59dca5.html">include</a></li><li class="navelem"><a class="el" href="dir_d66de6a51e5a24d2d6d7ec778992ab9f.html">firmware</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sram.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Traps to map SRAM into VM memory space.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab1cb4665b7b578012f173be37029d5e9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sram_8h.html#ab1cb4665b7b578012f173be37029d5e9">SramMap</a> (<a class="el" href="csrtypes_8h.html#a4b435a49c74bb91f284f075e63416cb6">uint32</a> sram_addr, <a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> size)</td></tr>
<tr class="memdesc:ab1cb4665b7b578012f173be37029d5e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maps external SRAM into the VM memory space.  <a href="#ab1cb4665b7b578012f173be37029d5e9">More...</a><br/></td></tr>
<tr class="separator:ab1cb4665b7b578012f173be37029d5e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef2476ae89e6cba45c83592dfe80e5da"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sram_8h.html#aef2476ae89e6cba45c83592dfe80e5da">SramAlloc</a> (<a class="el" href="csrtypes_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a> sz)</td></tr>
<tr class="memdesc:aef2476ae89e6cba45c83592dfe80e5da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate memory from SRAM.  <a href="#aef2476ae89e6cba45c83592dfe80e5da">More...</a><br/></td></tr>
<tr class="separator:aef2476ae89e6cba45c83592dfe80e5da"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Traps to map SRAM into VM memory space. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab1cb4665b7b578012f173be37029d5e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>* SramMap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="csrtypes_8h.html#a4b435a49c74bb91f284f075e63416cb6">uint32</a>&#160;</td>
          <td class="paramname"><em>sram_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maps external SRAM into the VM memory space. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sram_addr</td><td>External SRAM physical address to map </td></tr>
    <tr><td class="paramname">size</td><td>Size (in uint16s) of SRAM to map</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to start of mapped SRAM, NULL if cannot map</dd></dl>
<p>At the first invocation this finds a sufficient window in the VM's data address space and makes the requested portion of external SRAM visible; the application can then access external SRAM through the returned pointer (see below for the limitations). Subsequent invocations can map in different portions of SRAM, at which point any existing pointers into the old portion become invalid. (In general, accesses through such pointers cannot be trapped by the VM, so may cause subtly wrong behaviour rather than panicking the application).</p>
<p>There are restrictions on the use of external SRAM mapped in this way. The application may read and write to the SRAM directly, but pointers into it may not be passed into most traps; if an attempt is made to do so, the application will be stopped. Only a few traps fully support operations on pointers into SRAM &ndash; currently memset, memmove, and Util* traps.</p>
<p>If the requested size is greater than the maximum supported, or mapping fails for some other reason, a NULL pointer is returned.</p>
<p>To use external SRAM, the BlueCore device and firmware must both support it, and the application circuit must connect up the SRAM appropriately, including a PIO to select it (which will be unavailable for any other use). PSKEY_SRAM_PIO must be set to indicate this PIO to the firmware; by default the PSKEY is not set, and if not set, <a class="el" href="sram_8h.html#ab1cb4665b7b578012f173be37029d5e9" title="Maps external SRAM into the VM memory space. ">SramMap()</a> will always return NULL. Please refer to appropriate product data sheet for the PIO value. Also, the devices which have SQIF support, PSKEY_SRAM_SIZE must be set to indicate actual size of SRAM connected. If this PSKey holds its default value (i.e. 0) then address and size passed to this trap are never validated against the value of this PSKey. This can lead to mapping a non-existent area in SRAM.</p>
<p>External SRAM is only supported in certain BlueCore firmware. Please refer the appropriate product data sheet for external SRAM support and refer CS-307510-AN and CS-324244-AN for usage and other details.</p>
<p>Example Usage: ptr = PanicNull(SramMap(...));</p>
<dl class="section note"><dt>Note</dt><dd>Even if multiple mappings by application are not contiguous or mapping does not start from address 0, the available size for SRAM allocation will be restricted to the total SRAM size minus the highest address ever mapped using this trap. </dd></dl>

</div>
</div>
<a class="anchor" id="aef2476ae89e6cba45c83592dfe80e5da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* SramAlloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="csrtypes_8h.html#a7c94ea6f8948649f8d181ae55911eeaf">size_t</a>&#160;</td>
          <td class="paramname"><em>sz</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate memory from SRAM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>of allocation (in uint16s) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the allocated memory</dd></dl>
<p>This trap is used to allocate memory from SRAM. The pointer returned by this trap can be used to read/write data from/to SRAM. There are restrictions on the use of the pointer returned by this trap. SRAM pointer must be used within the VM application. The VM application must not pass the SRAM pointer to Bluecore firmware modules through trap/message interface since this can lead to panic. Only few standard memory operations related VM traps and utility operation related VM traps can handle this pointer directly. These traps are:</p>
<ol type="1">
<li>free()</li>
<li>memmove()</li>
<li>realloc()</li>
<li><a class="el" href="util_8h.html#ae37f040750c764758454dc4dc48fc9b8" title="Compare two blocks of memory of extent &#39;size&#39;, as uint16&#39;s. ">UtilCompare()</a></li>
<li><a class="el" href="util_8h.html#a2d263a02adb8eb2644213bf430a7eaff" title="Compares two memory blocks. ">UtilFind()</a></li>
<li><a class="el" href="util_8h.html#af1df67054a5167daac951190c82f4548" title="Converts a string into a number. ">UtilGetNumber()</a></li>
<li><a class="el" href="util_8h.html#a80ccf7971da4a8055b75899a3abf2534" title="Compute a uint16 hash value for the memory at &#39;data&#39;, of extent &#39;size&#39; uint16&#39;s, starting with the gi...">UtilHash()</a></li>
<li><a class="el" href="util_8h.html#af3716e288edcbffdc024ccc87fa145fc" title="Exchanges the high and low bytes of &#39;size&#39; words at &#39;data&#39;. ">UtilSwap()</a></li>
</ol>
<p>To use external SRAM, the BlueCore device and firmware must both support it, and the application circuit must connect up the SRAM appropriately, including a PIO to select it (which will be unavailable for any other use). PSKEY_SRAM_PIO must be set to indicate this PIO to the firmware; by default the PSKEY is not set. Please refer to appropriate product data sheet for the PIO value. Also, PSKEY_SRAM_SIZE must be set to indicate actual size of SRAM connected; this PSKEY holds a default value of zero. If either of these PSKEYs is not set, <a class="el" href="sram_8h.html#aef2476ae89e6cba45c83592dfe80e5da" title="Allocate memory from SRAM. ">SramAlloc()</a> will always return NULL.</p>
<dl class="section note"><dt>Note</dt><dd>For memory allocations from SRAM, some space within SRAM is consumed for metadata information. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Sep 2 2019 10:47:44 for BlueLab by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
